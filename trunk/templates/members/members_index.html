<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <title>Members of PullaClub.com</title>
    <link rel="SHORTCUT ICON" href="/favicon.gif"/>
    <link rel="stylesheet" href="http://www.pullaclub.com/css/pulla.css" type="text/css" />
    <script type="text/javascript" src="http://pullaclub.com/js/jquery-1.4.1.js"></script>
    <script type="text/javascript">
 $(document).ready(function() {
   $(".comment_button").click(function() {

     var element = $(this);
     var id = element.attr("id");

     $("#slidepanel"+id).slideToggle(100);
     $("#slidepanel"+id+" > textarea").focus();  
     return false;
   });

   $("#topic_button").click(function() {
     var element = $(this);
     var id = element.attr("id");

     $("#topicpanel").slideToggle(100);
     $("#topicpanel > textarea").focus();  
     return false;
   });

   $(".comment_submit").click(function(event){
    event.preventDefault();
    var panelid = $(this).parent().parent().attr("id");
    var url = $(this).siblings("[type='hidden']").attr("value");

    $.post(url, $(this).parent().serialize(), function(data) {
        var result = jQuery.parseJSON(data);
        if(result.id == "0") {
          $(".insertion[id='"+result.id+"']").prepend(result.render);
        } else 
           $(".insertion[id='"+result.id+"']").append(result.render);
    });    
     $("#"+panelid).slideToggle(300);
     $("textarea").val("");
    return false;
   });

   $("#topic_submit").click(function(event){
    event.preventDefault();
    var panelid = $(this).parent().parent().attr("id");

    var url = $(this).siblings("[type='hidden']").attr("value");
    $.post(url, $(this).parent().serialize(), function(data) {
        var result = jQuery.parseJSON(data);
        $("#topic").text(result.topic);
        $("#topic_time").text(result.topic_time);
        $("#topic_user").text(result.topic_user);
    });    
     $("#"+panelid).slideToggle(300);
     $("textarea").val("");
    return false;
   });
 });
    </script>
    <style type="text/css">
    .profile {
      float:left;
      width:80px;
      height:80px
      padding:5px;
      /* border:1px solid black; */
      text-align:center;
      margin-bottom:30px;
      margin-top: 5px;
      margin-left: 10px;
    }
    .update {
      margin: 5px 5px 15px 5px;
      padding-top: 5px;
      clear:both;
      width:90%;
      border-top: 1px dotted lightgray;
      border-left: 1px dotted lightgray;
      text-align:left;
    }
    .comment {
      margin:10px 0px 5px 110px;
      padding-left: 0.5em;
      padding-top: 0.5em;
      width:50%;
      text-align:left;
      border-top: 1px solid lightgray;
      border-left: 1px dotted lightgray;
    }
    .commentpanel { 
       display:none;
    }
    #topicpanel { 
       display:none;
       width:400;
       text-align:center;
    }
    </style>
  </head>
  <body>
    <div id="topnav">
      <ul>
	<li><a href="/index.html">Home</a></li>
	<li><a href="/members">Members</a></li>
        {% if user.is_staff %}
	<li><a href="/admin">Admin</a></li>
        {% endif %}
	<li><a href="/about.html">About us</a></li>
	<li style="float:right;"><a href="logout">Logout</a></li>
	<li style="float:right;"><a href="/changepassword">Change password</a></li>
      </ul>
    </div>
    <div>
    <center>
    <span id="topic" style="font-size:xx-large;border-bottom: 1px dotted lightgrey;" align="center">{{ topic.message }}</span>
    {% if user.is_staff %}
    <a href="#" id="topic_button" style="color:darkgrey;font-size:xx-small">Edit</a>
    {% endif %}
    <br>
    <span id="topic_time" style="font-weight:xx-small;color:lightgray;">{{ topic.datetime|timesince }} ago by <span id="topic_user">{{ topic.user.get_full_name }}</span></span>
    </center>
    </div>
    <div id="topicpanel">
      <form>
	<textarea id="topictext" style="width:400px;height:23px" name="message"></textarea><br/>
	<input type="hidden" value="/members/topic/new/">
	<input type="submit" value=" Update " id="topic_submit"/>
      </form>
    </div>
    <div style="height:10px;background-color:wheat;margin-bottom:20px;"></div>
    <div id="text" style="padding: 5px">
      Welcome {{ user.get_full_name }}
      <a style="color:grey;" href="/members/profile/view/{{ user.username }}">(Profile)</a>	  
      <a href="#" class="comment_button" id="0"><br>
	Make a comment</a>
      <!-- <strong style="float:right;">Today is Pulla</strong> -->
      <div class="commentpanel" id="slidepanel0">
	<form>
	  <textarea style="width:400px;height:56px" name="message"></textarea><br/>
	  <input type="hidden" value="/members/comment/new/0/">
	  <input type="submit" value=" Comment " class="comment_submit"/>
	</form>
      </div>
      <p>

      </p>
    </div>
    <div class="clear">
      <div class="insertion" id="0"></div>
      {% if view_list %}
      {% for update in view_list %}
      <p>
      <div class="update">
	<div class="profile">
	  <img style="margin-right:10px;" src="{{ update.rootcomment.user.get_profile.user_image.url }}" width=70 height=70>
	  <span id="text">{{ update.rootcomment.user.get_profile.description }}</span>
	</div>
	<div id="text">	  
	  <a href="/members/profile/view/{{ update.rootcomment.user.username }}"><span style="color:orange;">{{ update.rootcomment.user.get_full_name }}</span></a>
	  {{ update.rootcomment.message }} 
	</div>
	<p>
	  <span style="font-weight:xx-small;color:lightgray;">{{ update.rootcomment.datetime|timesince }} ago</span>
	  <a href="#" class="comment_button" id="{{ update.rootcomment.id }}" style="font-weight:xx-small;color:darkgrey;">Comment</a>

	{% for comment in update.subcomments %}
	<div class="comment">
	  <a href="/members/profile/view/{{ comment.user.username }}">
	    <span style="color:orange;">{{ comment.user.get_full_name }}</span></a>
	  <span style="color:grey;"> says {{ comment.message }}</span>
	  <p><span style="font-weight:xx-small;color:lightgray;">{{ comment.datetime|timesince }} ago</span></p>
	</div>
	{% endfor %}
 	<div class="insertion" id="{{ update.rootcomment.id }}"></div>
	  <div class="commentpanel" style="margin:10px 0px 5px 110px;" id="slidepanel{{ update.rootcomment.id }}">
	    <form>
	      <textarea style="width:250px;height:56px" name="message"></textarea><br/>
	      <input type="hidden" value="/members/comment/new/{{ update.rootcomment.id }}/">
	      <input type="submit" value=" Comment " class="comment_submit"/>
	    </form>
	  </div>
      </div> <!-- update -->
      {% endfor %}
      {% endif %}
    </div>
  </body>
</html>
