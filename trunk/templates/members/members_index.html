{% load custom_tags %}
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <title>Members of PullaClub.com</title>
    <link rel="SHORTCUT ICON" href="/favicon.gif"/>
    <link rel="stylesheet" href="/pullamedia/css/pulla.css" type="text/css" />
    <script type="text/javascript" src="http://pullaclub.com/js/jquery-1.4.1.js"></script>
    <script type="text/javascript">
 $(document).ready(function() {
     $(".comment_button").live('click',function() {

     var element = $(this);
     var id = element.attr("id");

     $("#slidepanel"+id).slideToggle(100);
     setTimeout(function() {$("#commenttext"+id).focus(); },300);
     return false;
   });

   $("#topic_button").click(function() {
     var element = $(this);
     var id = element.attr("id");

     $("#topicpanel").slideToggle(100);
     setTimeout(function() {$("#topictext").focus(); },300);
     return false;
   });

   $(".comment_submit").live('click',function(event){
    event.preventDefault();
    var panelid = $(this).parent().parent().attr("id");
    var url = $(this).siblings("[type='hidden']").attr("value");

    $.post(url, $(this).parent().serialize(), function(data) {
        var result = jQuery.parseJSON(data);
        if(result.id == "0") {
          $(".insertion[id='"+result.id+"']").prepend(result.render).css("display","none").slideToggle(300);
        } else 
           $(".insertion[id='"+result.id+"']").append(result.render).css("display","none").slideToggle(300);
    });    
     $("#"+panelid).slideToggle(100);
     $("textarea").val("");
     return false;
   });

   $("#topic_submit").click(function(event){
    event.preventDefault();
    var panelid = $(this).parent().parent().attr("id");

    var url = $(this).siblings("[type='hidden']").attr("value");
    $.post(url, $(this).parent().serialize(), function(data) {
        var result = jQuery.parseJSON(data);
        $("#topic").text(result.topic);
        $("#topic_time").text(result.topic_time);
        $("#topic_user").text(result.topic_user);
    });    
     $("#"+panelid).slideToggle(300);
     $("textarea").val("");
    return false;
   });
 });
    </script>
    <style type="text/css">
    </style>
  </head>
  <body>
    <div class="clear">
    <div id="topnav">
      <ul>
	<li><a href="/index.html">Home</a></li>
	<li><a href="/members">Members</a></li>
	<li><a href="/members/finance">Finances</a></li>
        {% if user.is_staff %}
	<li><a href="/admin">Admin</a></li>
        {% endif %}
	<li><a href="/about.html">About us</a></li>
	<li style="float:right;"><a href="logout">Logout</a></li>
	<li style="float:right;"><a href="/changepassword">Change password</a></li>
      </ul>
    </div>
    <center>
      <span id="topic" align="center">{{ topic.message|urlize }}</span>
      {% if user.is_staff %}
      <a href="#" id="topic_button">Edit</a>
      {% endif %}
      <br>
      <span id="topic_time" class="time_stamp">{{ topic.datetime|timesince }} ago by <span id="topic_user">{{ topic.user.get_full_name }}</span></span>
    </center>
    <div id="topicpanel">
      <form>
	<textarea id="topictext" name="message"></textarea><br/>
	<input type="hidden" value="/members/topic/new/">
	<input type="submit" value=" Update " id="topic_submit"/>
      </form>
    </div>

    <!-- head and body separator -->
    <!--<div style="height:10px;background-color:wheat;margin-bottom:20px;"></div>-->
    <hr>

    <div id="main">
      <div class="text" style="background:grey;color:white">
	<strong>{{ user.get_full_name }}</strong>
	<span style="float:right"><a href="/members/profile/view/{{ user.username }}">Profile</a></span>
      </div>
    <p>
      <a class="round_button" href="#"><span class="comment_button" id="0">Make new comment</span></a>  
      <a class="round_button" href="."><span>Load new comments</span></a>  
      
      <span class="text" style="float:right;font-size:small">
	Page
	{% for c in page_count|times %}
	<a href="/members/{{ c }}"{% ifequal c active_page %}style="font-weight:bold;"{% endifequal %}>
	{% if forloop.first %}top{% else %}{{ c }}{% endif %}
	</a>|
    {% endfor %}
      </span>
      <br>
    </p>
    <div class="comment_panel" style="margin:0" id="slidepanel0">
      <form>
	<textarea id="commenttext0" name="message"></textarea><br/>
	<input type="hidden" value="/members/comment/new/0/">
	<input type="submit" value=" Comment " class="comment_submit"/>
      </form>
    </div> <!-- comment_panel -->
    <p></p>
      <div class="insertion" id="0"></div>
      {% if view_list %}
      {% for update in view_list %}
      <p>
      <div class="update">
	<div class="profile">
	  <img src="{{ update.rootcomment.user.get_profile.user_image.url }}" width=70 height=70>
	  <span class="text">{{ update.rootcomment.user.get_profile.description }}</span>
	</div>
	<div class="text">	  
	  <a href="/members/profile/view/{{ update.rootcomment.user.username }}"><span class="user_name">{{ update.rootcomment.user.get_full_name }}</span></a>
	  <span class="time_stamp">{{ update.rootcomment.datetime|timesince }} ago</span>
	  <br>
	  {{ update.rootcomment.message|urlize }} 
	  <p>
    	    <a href="#" class="comment_button" id="{{ update.rootcomment.id }}">Comment</a>
<!--
    	    <a href="#" class="update_button" id="{{ update.rootcomment.id }}">Edit</a>
    	    <a href="#" class="delete_button" id="{{ update.rootcomment.id }}">Delete</a>
-->
	  </p>
	</div>
	  {% for comment in update.subcomments %}
	<div class="text">
	  <div class="comment">
	      <a href="/members/profile/view/{{ comment.user.username }}">
		<span class="user_name">{{ comment.user.get_full_name }}</span></a>
	      <span class="time_stamp">{{ comment.datetime|timesince }} ago</span>
	      <br>{{ comment.message|urlize }}
	  </div>
	</div>
	  {% endfor %}
 	  <div class="insertion" id="{{ update.rootcomment.id }}"></div>
	  <div class="comment_panel" id="slidepanel{{ update.rootcomment.id }}">
	    <form>
	      <textarea id="commenttext{{ update.rootcomment.id }}" style="width:250px;height:56px" name="message"></textarea><br/>
	      <input type="hidden" value="/members/comment/new/{{ update.rootcomment.id }}/">
	      <input type="submit" value=" Comment " class="comment_submit"/>
	    </form>
	  </div>
      </div> <!-- update -->
      {% endfor %}
      {% endif %}
      <br>
      <p style="float:right">
            <span class="text" style="font-size:small">
	Page
	{% for c in page_count|times %}
	<a href="/members/{{ c }}"{% ifequal c active_page %}style="font-weight:bold;"{% endifequal %}>
	{% if forloop.first %}top{% else %}{{ c }}{% endif %}
	</a>|
    {% endfor %}
      </span>
      </p>
    </div> <!-- main -->
    <div id="sidebar">
      <div class="listtitle">Our members</div>
      <p>
      {% for user in member_list %}
      {{ user.get_full_name }}
      {% if user.is_staff %}
      <strong><span style="float:right">staff</span></strong>
      {% else %}
      <span style="float:right">*</span>
      {% endif %}
      <br>
      {% endfor %}
      </p>
      <div class="listtitle">Old topics</div>
      <p>
      {% for topic in topic_list %}
      <div title="{{ topic.message }}" style="font-size:xx-small;border-bottom:1px dotted grey;">{{ topic.as_truncated }} <span style="color:grey;float:right">{{ topic.datetime|date:"D M" }}</span></div>
      {% endfor %}
      </p>
    </div> <!-- sidebar -->
    </div> <!-- clear -->
  </body>
</html>
